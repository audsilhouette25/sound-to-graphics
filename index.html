<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>IML Audio Workstation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="ui-container">
        <h2>IML Workstation</h2>
        
        <div class="step-box">
            <p>1. 오디오 입력</p>
            <input type="file" id="file-input" accept="audio/*" style="display:none">
            <button onclick="document.getElementById('file-input').click()">📁 파일 찾기</button>
            <button id="btn-record" onclick="toggleRecord()">🎤 마이크 녹음</button>
            
            <div id="confirm-area" class="hidden" style="margin-top:10px; border-top:1px solid #444; padding-top:10px;">
                <span id="file-name" style="font-size:0.8em; color:#00ffcc;"></span>
                <button id="btn-confirm" onclick="startAnalysis()" style="background:#00ffcc; color:black; margin-top:5px;">
                    🚀 분석 및 시각화 시작
                </button>
            </div>
        </div>

        <div id="player-area" class="step-box hidden">
            <p>2. 확인 및 구간 선택</p>
            <audio id="audio-player" controls style="width:100%; margin-bottom:10px;"></audio>
            
            <div id="timeline-container">
                <div id="timeline-bar">
                    <div id="selection-box"></div> <div id="playhead"></div>      </div>
                <div style="font-size:0.7em; color:#888; margin-top:5px; display:flex; justify-content:space-between;">
                    <span>드래그하여 수정 구간 선택</span>
                    <button onclick="clearSelection()" style="width:auto; padding:2px 8px; font-size:10px; background:#555;">선택 해제</button>
                </div>
            </div>
        </div>

        <div id="edit-panel" class="step-box hidden" style="border-color: #ff0055;">
            <p style="color:#ff0055; font-weight:bold;">3. 구간 수정 (Editing)</p>
            
            <div class="control-row">
                <button class="shape-btn" id="s-0" onclick="setOverrideShape(0)">Jagged</button>
                <button class="shape-btn" id="s-1" onclick="setOverrideShape(1)">Fluid</button>
                <button class="shape-btn" id="s-2" onclick="setOverrideShape(2)">Granular</button>
            </div>

            <div class="control-row"><label>크기 (Scale)</label><input type="range" id="sl-scale" min="0" max="1" step="0.01"></div>
            <div class="control-row"><label>투명도 (Opacity)</label><input type="range" id="sl-opacity" min="0" max="1" step="0.01"></div>
            <div class="control-row"><label>날카로움 (Spike)</label><input type="range" id="sl-spikiness" min="0" max="1" step="0.01"></div>
            <div class="control-row"><label>질감 (Grain)</label><input type="range" id="sl-grain" min="0" max="1" step="0.01"></div>

            <div style="margin-top:15px; border-top:1px solid #555; padding-top:10px;">
                <button onclick="applyOverrideToSelection()" style="background:#ff0055; color:white; font-weight:bold;">
                    ✨ 구간 적용하기 (Apply)
                </button>
                <p style="font-size:0.7em; color:#aaa; margin-top:5px;">
                    * 위 버튼을 눌러야 선택한 구간의 데이터가 실제로 변경됩니다.
                </p>
            </div>
        </div>

        <div id="train-panel" class="step-box hidden" style="border-color: #7700ff;">
            <p style="color:#7700ff; font-weight:bold;">4. 결과 학습 (Training)</p>
            <p style="font-size:0.8em; color:#ccc; margin-bottom:10px;">
                수정한 결과들을 모델에 학습시켜, 다음번엔 더 내 취향에 맞게 분석하도록 합니다.
            </p>
            <button id="btn-train" onclick="trainModel()" style="background:#7700ff;">
                🧠 AI 모델 학습시키기
            </button>
        </div>

    </div>
    <div id="canvas-wrapper"></div>
    <script src="sketch.js"></script>
</body>
</html>